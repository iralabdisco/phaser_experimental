#!/usr/bin/env sh
REST=$@
EXP_DIR="/home/fdila/"
current_time=$(date "+%Y-%m-%d-%H-%M")
RESULT_DIR="/home/fdila/phaser_results/$current_time/"

rm -rf $RESULT_DIR
mkdir -p $RESULT_DIR

cp "${EXP_DIR}target.ply" "$RESULT_DIR/target.ply"
cp "${EXP_DIR}source.ply" "$RESULT_DIR/source.ply"

rosrun phaser_core phaser_core_driver \
  --v=2 \
  --alsologtostderr=1 \
  --registration_algorithm="sph-opt-multiple" \
  --target_cloud="${EXP_DIR}target.ply" \
  --source_cloud="${EXP_DIR}source.ply" \
  --reg_cloud="registered" \
  --results_folder="${RESULT_DIR}" \
  --phaser_pre_enable_geometric_cloud_segmentation=false \
  --phaser_core_spherical_bandwidth=80 \
  --phaser_core_spherical_low_pass_lower_bound=000 \
  --phaser_core_spherical_low_pass_upper_bound=10000 \
  --phaser_core_spherical_zero_padding=10 \
  --phaser_core_spatial_n_voxels=100 \
  --phaser_core_spatial_discretize_lower=-50 \
  --phaser_core_spatial_discretize_upper=50 \
  --phaser_core_spatial_low_pass_lower_bound=85 \
  --phaser_core_spatial_low_pass_upper_bound=115 \
  --phaser_core_spatial_zero_padding=0 \
  --gaussian_peak_neighbors=0 \
  --bingham_peak_neighbors_radius=5\
  --gaussian_peak_neighbors_radius=5\
  --max_peaks_number=3 \
  --peaks_discard_threshold=0.5 \
  --visualize_correlation=false \
  --dump_correlation_to_file=true \
  --dump_peaks_to_file=true \

echo "Saved to $RESULT_DIR"

$REST